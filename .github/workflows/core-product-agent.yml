name: Product Issue Agent

on:
  schedule:
    # Example: run every day at 09:00 UTC
    - cron: '0 9 * * *'

  push:
    branches:
      - main
    paths:
      - '.github/workflows/core-product-agent.yml'
      - '.github/workflows/core-specialized-agents.yml'
      - 'seedgpt-core/src/agents/product_agent.py'
      - 'seedgpt-core/src/agents/base_issue_agent.py'

  pull_request:
    paths:
      - '.github/workflows/core-product-agent.yml'
      - '.github/workflows/core-specialized-agents.yml'
      - 'seedgpt-core/src/agents/product_agent.py'
      - 'seedgpt-core/src/agents/base_issue_agent.py'

  workflow_dispatch:
    inputs:
      dry_mode:
        description: 'Run in dry mode (no issues created)'
        required: false
        default: false
        type: boolean
      min_issues:
        description: 'Minimum product issues to maintain'
        required: false
        default: '2'
        type: string

permissions:
  contents: read
  issues: write
  pull-requests: read

jobs:
  validate-on-change:
    if: github.event_name == 'pull_request' || github.event_name == 'push'
    uses: ./.github/workflows/core-specialized-agents.yml
    secrets: inherit
    with:
      agent: product
      dry_mode: true
      min_issues: '1'

  run-product-agent:
    if: github.event_name != 'pull_request' && github.event_name != 'push'
    uses: ./.github/workflows/core-specialized-agents.yml
    secrets: inherit
    with:
      agent: product
      dry_mode: ${{ inputs.dry_mode || false }}
      min_issues: ${{ inputs.min_issues || '2' }}
