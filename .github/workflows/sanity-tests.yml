name: Sanity Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sanity-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Check project structure
        run: |
          echo "üîç Checking project structure..."
          
          # Check main directories exist
          test -d seedgpt-core/src/claude-agent && echo "‚úÖ Claude agent directory exists" || echo "‚ùå Claude agent directory missing"
          test -d seedgpt-core/src/gemini-agent && echo "‚úÖ Gemini agent directory exists" || echo "‚ùå Gemini agent directory missing"
          test -d seedgpt-core/tests && echo "‚úÖ Tests directory exists" || echo "‚ùå Tests directory missing"
          test -d .github/workflows && echo "‚úÖ Workflows directory exists" || echo "‚ùå Workflows directory missing"
          
          # Check key files exist
          test -f seedgpt-core/src/claude-agent/claude_cli_agent.py && echo "‚úÖ Claude CLI agent exists" || echo "‚ùå Claude CLI agent missing"
          test -f seedgpt-core/src/gemini-agent/gemini_agent.py && echo "‚úÖ Gemini agent exists" || echo "‚ùå Gemini agent missing"
          test -f seedgpt-core/tests/unit/test_claude_cli_agent.py && echo "‚úÖ Claude unit tests exist" || echo "‚ùå Claude unit tests missing"
          test -f seedgpt-core/tests/unit/test_gemini_agent.py && echo "‚úÖ Gemini unit tests exist" || echo "‚ùå Gemini unit tests missing"
      
      - name: Check Python syntax
        run: |
          echo "üîç Checking Python syntax..."
          
          # Check Claude agent
          python -m py_compile seedgpt-core/src/claude-agent/claude_cli_agent.py && echo "‚úÖ Claude agent syntax OK" || echo "‚ùå Claude agent syntax error"
          
          # Check Gemini agent
          python -m py_compile seedgpt-core/src/gemini-agent/gemini_agent.py && echo "‚úÖ Gemini agent syntax OK" || echo "‚ùå Gemini agent syntax error"
          
          # Check logging config
          test -f seedgpt-core/src/logging_config.py && python -m py_compile seedgpt-core/src/logging_config.py && echo "‚úÖ Logging config syntax OK" || echo "‚ö†Ô∏è Logging config not found or has syntax error"
      
      - name: Check bash scripts
        run: |
          echo "üîç Checking bash scripts..."
          
          # Check Claude scripts
          for script in seedgpt-core/src/claude-agent/scripts/*.sh; do
            if [ -f "$script" ]; then
              bash -n "$script" && echo "‚úÖ $(basename $script) syntax OK" || echo "‚ùå $(basename $script) syntax error"
            fi
          done
          
          # Check Gemini scripts
          for script in seedgpt-core/src/gemini-agent/scripts/*.sh; do
            if [ -f "$script" ]; then
              bash -n "$script" && echo "‚úÖ $(basename $script) syntax OK" || echo "‚ùå $(basename $script) syntax error"
            fi
          done
      
      - name: Sanity check summary
        if: always()
        run: |
          echo "‚úÖ Sanity checks completed"
          echo ""
          echo "Note: This workflow performs basic sanity checks."
          echo "For full testing, see the 'Test AI Agents' workflow."
